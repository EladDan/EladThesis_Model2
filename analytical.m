clear;
N = 28;
r = 0.05;
a = 0.04;
t = (1-r)*(1-a);

p = t;
q = r;

term_1 = sqrt(-4*p^2 + (1 + p^2 - q^2)^2);


z = (-2^-N*q*(1/p*(1 + p^2 - q^2 -term_1))^(-1+N)+...
    (2^(1-N)*q*(1/p*(1 + p^2 - q^2 - term_1))^(-1+N))/...
    (term_1) -...
    (2^-N*q*(1/p*(1 + p^2 - q^2 -term_1))^(-1+N))/...
    (term_1) + ...
    (2^-N*p^2*q*(1/p*(1 + p^2 - q^2 - term_1))^(-1+N))/...
    (term_1) -...
    (2^-N * q^3 *(1/p * (1 + p^2 - q^2 - term_1))^(-1+N))/...
    (term_1) -...
    2^-N * q *(1/p*(1 + p^2 - q^2 + term_1))^(-1+N) -...
    (2^(1 - N)*q*(1/p * (1 + p^2 - q^2 + term_1))^(-1+N))/...
    (sqrt(-4 * p^2 + (1 + p^2 - q^2)^2)) + ...
    (2^-N*q*(1/p*(1 + p^2 - q^2 + term_1))^(-1+N))/...
    (term_1) -...
    (2^-N*p^2*q*(1/p*(1 + p^2 - q^2 + term_1))^(-1+N))/...
    (term_1) +...
    (2^-N*q^3*(1/p*(1 + p^2 - q^2 + term_1))^(-1+N))/...
    (term_1))/...
    (-2^-N*(1/p*(1 + p^2 - q^2 - term_1))^(-1 +N) +...
    (2^-N*(1/p*(1 + p^2 - q^2 - term_1))^(-1 +N))/...
    (term_1) -...
    (2^-N*p^2*(1/p*(1 + p^2 - q^2 - term_1))^(-1 +N))/...
    (term_1) -...
    (2^(1 - N)* q^2 *(1/p*(1 + p^2 - q^2 - term_1))^(-1 + N))/...
    (term_1) +...
    (2^-N*q^2*(1/p*(1 + p^2 - q^2 - term_1))^(-1 +N))/...
    (term_1) -...
    2^-N*(1/p*(1 + p^2 - q^2 + term_1))^(-1+N) -...
    (2^-N*(1/p*(1 + p^2 - q^2 + term_1))^(-1+N))/...
    (term_1) +...
    (2^-N * p^2 * (1/p * (1 + p^2 - q^2 + term_1))^(-1+N))/...
    (term_1) +...
    (2^(1 - N) * q^2 * (1/p * (1 + p^2 - q^2 + term_1))^(-1+N))/...
    (term_1) -...
    (2^-N * q^2 * (1/p * (1 + p^2 - q^2 + term_1))^(-1+N))/...
    (term_1));

idx = 1;
x(idx) = 1; % start condition (x(0)=1)
for j = 1:N-1
    idx = idx + 1;
    % f1(j)
    x(idx) = 1/term_1*...
    2^(-1 - j)*((1/p*(1 + p^2 - q^2 - sqrt(-4*p^2 +(1 + p^2 - q^2)^2)))^j -...
    p^2*(1/p*(1 + p^2 - q^2 - term_1))^j +...
    q^2*(1/p*(1 + p^2 - q^2 -term_1))^j +...
    term_1...
    *(1/p*(1 + p^2 - q^2 - sqrt(-4*p^2 +(1 + p^2 - q^2)^2)))^j -...
    (1/p*(1 + p^2 - q^2 + term_1))^j +...
    p^2*(1/p*(1 + p^2 - q^2 + term_1))^j -...
    q^2*(1/p*(1 + p^2 - q^2 + term_1))^j +...
    term_1*...
    (1/p*(1 + p^2 - q^2 + term_1))^j -...
    2*q*(1/p*(1 + p^2 - q^2 - term_1))^j* z +...
    2*q*(1/p*(1 + p^2 - q^2 + term_1))^j* z);
end

for j = 1:N-1
    idx = idx + 1;
    % f2(j)
    x(idx) = 1/term_1 *  2^(-1 - j) *...
    (2*q*(1/p*(1 + p^2 - q^2 - term_1))^j -...
    2*q*(1/p*(1 + p^2 - q^2 + term_1))^j -...
    (1/p*(1 + p^2 - q^2 - term_1))^j * z +...
    p^2 * (1/p * (1 + p^2 - q^2 - term_1))^j*z -...
    q^2 * (1/p * (1 + p^2 - q^2 - term_1))^j*z +...
    term_1*...
    (1/p*(1 + p^2 - q^2 - term_1))^j*z +...
    (1/p*(1 + p^2 - q^2 + term_1))^j*z -...
    p^2 *(1/p *(1 + p^2 - q^2 + term_1))^j * z +...
    q^2 *(1/p *(1 + p^2 - q^2 + term_1))^j * z +...
    term_1*...
    (1/p *(1 + p^2 - q^2 + term_1))^j * z);
end
x

